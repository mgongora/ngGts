!function(e){e.module("nggts.config",[]).value("nggts.config",{debug:!0}),e.module("nggts.templates",[]),e.module("nggts.directives",[]),e.module("nggts.filters",[]),e.module("nggts.services",[]),e.module("nggts",["nggts.config","nggts.templates","nggts.directives","nggts.filters","nggts.services","ngSanitize"])}(angular),angular.module("nggts.directives").directive("gtsCrud",["$templateCache","$compile",function(e,t){function l(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function a(e){var t={text:'<div class="form-group form-md-floating-label form-md-line-input">\n        <label class="col-md-2 control-label" for="txt_[col-name]">[col-title]</label>\n        <div class="col-md-10">\n         <input type="text" ng-model="model.data.[col-name]" ng-disabled="!isEditable([col-editable])" tabindex="[col-position]"\n           class="form-control" id="txt_[col-name]" placeholder="Ingresar [col-title]">\n         <div class="form-control-focus"></div>\n        </div>\n      </div>\n',date:'<div class="form-group form-md-floating-label form-md-line-input">\n        <label class="col-md-2 control-label" for="dat_[col-name]}}">[col-title]</label>\n        <div class="col-md-10">\n          <input class="form-control form-control-inline input-medium date-picker" size="16" type="text"  gts-date-picker             data-autoclose="true" data-language="es" data-today-highlight="true" data-date-format="dd-mm-yyyy" data-date-start-date="+0d"\n            data-model="model.data.[col-name]" ng-disabled="!isEditable([col-editable])" tabindex="[col-position]" id="dat_[col-name]"\n            class="success" />\n            <div class="form-control-focus"></div>\n        </div>\n      </div>\n',password:'<div class="form-group form-md-floating-label form-md-line-input">\n        <label class="col-md-2 control-label" for="pwd_[col-name]">[col-title]</label>\n        <div class="col-md-10">\n          <input type="password" ng-model="model.data.[col-name]" ng-disabled="!isEditable([col-editable])" tabindex="[col-position]"\n            class="form-control" id="pwd_[col-name]" placeholder="Ingresar [col-title]">\n          <div class="form-control-focus"></div>\n        </div>\n      </div>\n',"boolean":'<div class="form-group form-md-floating-label form-md-line-input">\n        <label class="col-md-2 control-label" for="ckx_[col-name]">[col-title]</label>\n        <div class="md-checkbox md-checkbox-inline">\n          <input ng-model="model.data.[col-name]" ng-disabled="!isEditable([col-editable])" type="checkbox"\n           tabindex="[col-position]" id="ckx_[col-name]" class="md-check">\n          <label>\n            <span></span>\n            <span class="check"></span>\n            <span class="box"></span>\n          </label>\n          <div class="form-control-focus"></div>\n        </div>\n      </div>\n',foreignKey:'<div class="form-group form-md-floating-label">\n        <label class="col-md-2 control-label" for="cbx_[col-name]">[col-title]</label>\n        <div class="col-md-10" tabindex="[col-position]">\n          <input type="text" ng-model="model.data.[col-name]" ng-disabled="!isEditable([col-editable])"           typeahead="item.[col-value] as item.[col-text] for item in [col-options] | filter:$viewValue | limitTo:8"           typeahead-input-formatter="formatLabel($model, [col-options], [col-value], [col-text])" class="form-control"           id="cbx_[col-name]" placeholder="Ingresar [col-title]">\n          <div class="form-control-focus"></div>\n        </div>\n      </div>\n',selection:'<div class="form-group form-md-floating-label form-md-dropdown-input">\n        <label class="col-md-2 control-label" for="cbx_[col-name]">[col-title]</label>\n        <div class="col-md-10">\n          <ui-select id="cbx_[col-name]" ng-model="model.data.[col-name]" theme="bootstrap" ng-disabled="!isEditable([col-editable])">\n            <ui-select-match placeholder="Ingrese texto para buscar...">{{$select.selected.[col-text]}}</ui-select-match>\n            <ui-select-choices repeat="item.[col-value] as item in [col-options] | filter: $select.search">\n              <div ng-bind-html="item.[col-text] | highlight: $select.search"></div>\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n',multiSelection:'<div class="form-group form-md-floating-label form-md-dropdown-input">\n        <label class="col-md-2 control-label" for="cbx_[col-name]">{{[col-title]}}</label>\n        <div class="col-md-10">\n          <ui-select multiple id="cbx_[col-name]" ng-model="model.data.[col-name]" theme="bootstrap" close-on-select="false"\n          ng-disabled="!isEditable([col-editable])">\n            <ui-select-match placeholder="Ingrese texto para buscar...">{{$item.[col-text]}}</ui-select-match>\n            <ui-select-choices repeat="item.[col-value] as item in [col-options] | filter: $select.search">\n              <div ng-bind-html="item.[col-text] | highlight: $select.search"></div>\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n',details:'<div class="form-group form-md-floating-label">\n      </div>\n'};return t[e]}function i(e){var t='<div class="row">\n          <div class="col col-md-12 form">\n            <div role="form" class="form-horizontal">\n              <div class="form-body">\n';console.log("columnas en getEdit",e);for(var l=_.sortBy(_.where(e,{editable:!0}),function(e){return e.position||9999999}),i=0;i<l.length;i++){var o=l[i],n=a(o.type);n=n.replace(/\[col-name]/g,o.name).replace(/\[col-title]/g,o.title).replace(/\[col-position]/g,o.position).replace(/\[col-editable]/g,o.editable).replace(/\[col-position]/g,o.position).replace(/\[col-text]/g,o.text).replace(/\[col-value]/g,o.value).replace(/\[col-options]/g,o.options),t+=n}return t+="     </div>\n            </div>\n          </div>\n        </div>\n"}function o(e){var t,l="",a="",i='<div class="row">\n          <div class="col-md-6 col-sm-12">\n            <div class="dataTables_length" id="sample_1_length">\n              <label>\n                <select ng-model="pager.pageSize" ng-change="pager.pageChanged()" class="form-control input-xsmall input-inline"\n>\n                  <option value="5">5</option>\n                  <option value="15">15</option>\n                  <option value="20">20</option>\n                  <option value="-1">Todos</option>\n                </select> Registros\n              </label>\n            </div>\n          </div>\n          <div class="col-md-6 col-sm-12">\n            <div id="sample_1_filter" class="dataTables_filter">\n              <label>\n                Buscar:\n                <input type="search" class="form-control input-inline input-large" placeholder="" aria-controls="sample_1">\n              </label>\n            </div>\n          </div>\n        </div>\n        <table class="table table-condensed table-striped table-bordered table-hover">\n          <thead>\n            <tr>\n              [header-cells]              <th width="150px"></th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr ng-repeat="item in items" class="odd gradeX">\n              [value-cells]              <td>\n                <a ng-click="view(item)" class="btn btn-xs btn-primary"><i class="fa fa-check-square-o"></i></a>\n                <a ng-click="edit(item)" class="btn btn-xs btn-warning"><i class="fa fa-edit"></i></a>\n                <a ng-click="delete($index)" class="btn  btn-xs btn-danger"><i class="fa fa-trash-o"></i></a>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n        <div class="row">\n          <div class="col-md-5 col-sm-12">\n            <div class="dataTables_info" id="sample_2_info" role="status" aria-live="polite">{{getPagerStatus()}}</div>\n          </div>\n          <div class="col-md-7 col-sm-12">\n            <div class="dataTables_paginate paging_simple_numbers">\n              <pagination boundary-links="true" total-items="pager.totalItems" items-per-page="pager.pageSize"               ng-change="pager.pageChanged()" ng-model="pager.page" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;"               last-text="&raquo;"></pagination>\n            </div>\n          </div>\n        </div>\n',o=_.sortBy(_.where(e,{visible:!0}),function(e){return e.position||9999999});for(t=0;t<o.length;t++){var n=o[t];l+="<th>\n"+n.title+"</th>\n",a+="selection"===n.type||"foreign-key"===n.type?"<td>{{getOptionsAttribute(item."+n.name+", "+n.options+", "+n.value+", "+n.text+")}}</td>\n":"date"===n.type?"<td>{{item."+n.name+" | date:'dd/MM/yyyy'}}</td>\n":"<td>{{item."+n.name+"}}</td>\n"}return i.replace(/\[header-cells]/g,l).replace(/\[value-cells]/,a)}return{scope:{title:"@title",icon:"@icon",columns:"=columns",serviceUrl:"@serviceUrl",items:"=?items",pageSize:"@pageSize",currentPage:"=?currentPage",filters:"@filters",selectIndex:"=?selectedIndex",selectedItem:"=?selectedItem",onItemAdded:"&onItemAdded",onItemChanged:"&onItemChanged",onItemRemoved:"&onItemRemoved",onSelectedItem:"&onSelectedItem",onClickEdit:"&",onClickDelete:"&",onClickShow:"&",onClickNew:"&",gridTemplate:"@gridTemplate",detailsTemplate:"@detailsTemplate",editTemplate:"@editTemplate"},restrict:"E",replace:!0,link:function(e,a,n){e.$watch("columns",function(l,n){if(l&&l.length>0&&l!==n){var s=o(e.columns);console.log(s),console.log("========================================"),console.log("columnas en link",e.columns);var c=i(e.columns);console.log(c),a.html(s).show(),t(a.contents())(e),e.get()}}),e.isFunction=function(t){return angular.isDefined(n[t])&&l(e[t])}}}}]).controller("gtsCrudListController",["$scope","$modal","ApiClient",function(e,t,l){e.items=e.items||[],e.gridTemplate=e.gridTemplate||"nggts/directives/gts-crud/gts-crud-list.html",e.pager={page:e.currentPage||1,pageSize:e.pageSize},e.getKey=function(t){var l;return e.keyAttribute?e.items&&e.items[t]&&(l=e.items[t][e.keyAttribute]):console.error("Se debe definir el atributo llave en el scope, $scope.keyAttribute = 'nombre-atributo-clave';"),l},e.getOptionsAttribute=function(e,t,l,a){var i=!1,o="",n=0;if(console.log("+++++++++++++++++++++++++++++++++++++++++++",e,t,l,a),!t)return o;for(;!i&&n<t.length;){var s=t[n];s[l]===e&&(i=!0,o=s[a]),n++}return o},e.get=function(){e.serviceUrl?l.get(e.serviceUrl+"?page="+e.pager.page+"&pageSize="+e.pager.pageSize).then(function(t){0!==t.code?e.items=[]:(e.items=t.data,e.pager.totalItems=t.itemsCount)},function(e){console.log(e)}):e.items&&(e.originalItems||(e.originalItems=e.items),e.pager.totalItems=e.originalItems.length,e.items=e.originalItems.slice((e.pager.page-1)*e.pager.pageSize,e.pager.pageSize))},e.getPagerStatus=function(){var t="Mostrando "+(e.pager.pageSize*e.pager.page-e.pager.pageSize+1)+" al ";return t+=e.pager.pageSize*e.pager.page<=e.pager.totalItems?e.pager.pageSize*e.pager.page:e.pager.totalItems,t+=" de "+e.pager.totalItems+" registros"},e.pager.pageChanged=function(){e.get()},e.delete=function(t){if(e.serviceUrl){var a=e.getKey(t);a&&l.delete(e.serviceUrl,a).then(function(l){0!==l.code?console.log(l):e.items.splice(t,1)},function(t){e.showAlert("Ocurrió un error, por favor intenta nuevamente","danger"),console.log(t)})}else e.items.slice(t)},e.edit=function(t){"function"==typeof e.onClickEdit?e.onClickEdit()(t):e.openModal("edit",t)},e.new=function(){"function"==typeof e.onClickNew?e.onClickNew()():e.openModal("new")},e.view=function(t){"function"==typeof e.onClickShow?e.onClickShow()(t):e.openModal("view",t)},e.openModal=function(l,a){"new"===l&&(a={},e.items.push(a)),e.selectedItem=a;var i=t.open({animation:e.animationsEnabled,templateUrl:e.detailsTemplate||"nggts/directives/gts-crud/gts-crud-details.html",size:"lg",controller:"gtsCrudDetailsController",resolve:{model:function(){return{data:e.selectedItem,title:e.title,serviceUrl:e.serviceUrl,columns:e.columns,action:l}}}});i.result.then(function(t){console.log("Modal closed",t,e.selectedItem)},function(e){console.log("Modal dismissed at: "+e)})}}]).controller("gtsCrudDetailsController",["$scope","$modalInstance","ApiClient","model",function(e,t,l,a){function i(){for(var t=!1,l=null,a=0,i=e.model.columns;!t&&a<i.length;)"key"===i[a].type&&(t=!0,l=e.model.data[i[a].name]),a++;return l}e.model=a,e.alert={},e.isEditable=function(t){return"$form"===t?"new"===e.model.action||"edit"===e.model.action:t!==!1&&("new"===e.model.action||"edit"===e.model.action)},e.formatLabel=function(e,t,l,a){for(var i=0;i<t.length;i++)if(e===t[i][l])return t[i][a]},e.showColumn=function(e){return e.visible||e.editable};var o=function(){l.post(e.model.serviceUrl,e.model.data).then(function(t){0!==t.code?e.showAlert(t.description,"danger"):e.showAlert(t.description,"success")},function(t){e.showAlert("Ocurrió un error, por favor intenta nuevamente","danger"),console.log(t)})},n=function(){l.put(e.model.serviceUrl+"/"+i(),e.model.data).then(function(t){0!==t.code?e.showAlert(t.description,"danger"):e.showAlert(t.description,"success")},function(t){e.showAlert("Ocurrió un error, por favor intenta nuevamente ","danger"),console.log(t)})};e.save=function(){if(e.model.serviceUrl){var t=i();null!=t?n():o()}else e.showAlert("Se agrego el elemento con exito","success")},e.ok=function(){t.close(e.model.data)},e.cancel=function(){t.dismiss("cancel")},e.showAlert=function(t,l){e.alert.show=!0,e.alert.msg=t,e.alert.type=l},e.closeAlert=function(){e.alert.show=!1,e.alert.msg="",e.alert.type=""}}]),angular.module("nggts.directives").directive("gtsDatePicker",["$timeout","$http","$templateCache","$compile",function(e,t,l,a){return{restrict:"EA",replace:!0,link:function(e,i,o){var n=o.template,s=o.ngModel,c=null,d="nggts/directives/gts-date-picker/gts-date-picker-default.html";"form-group"===n&&(d="nggts/directives/gts-date-picker/gts-date-picker-form-group.html"),t.get(d,{cache:l}).success(function(t){t=t.replace("[data-model]",s);var l=a(t)(e);$().datepicker&&(c=l.datepicker(o),e[s]&&c.datepicker("setDate",e[s]),c.on("changeDate",function(t){e[s]=t.date,e.$apply()})),i.replaceWith(l)}),e.$watch(s,function(e,t){c&&e!==t&&c.datepicker("update",e)})}}}]),angular.module("nggts.templates").run(["$templateCache",function(e){e.put("nggts/directives/gts-crud/gts-crud-details-list.html",'<div class="portlet light"><div class=portlet-title><div class=caption><span class="caption-subject font-blue-steel bold uppercase">{{title}}</span> <span class=caption-helper>listado</span></div><div class=actions><a href ng-click="open(\'new\')" class="btn btn-circle btn-default btn-sm"><i class="fa fa-plus"></i> Agregar</a></div></div><div class=portlet-body><table class="table table-condensed table-striped table-bordered table-hover" id=sample_2><thead><tr><th ng-repeat="col in columns | filter:{visible : true} | orderBy:\'position||9999\'">{{col.title}}</th><th width=150px></th></tr></thead><tbody><tr ng-repeat="item in items" class="odd gradeX"><td ng-repeat="col in columns | filter:{visible : true} | orderBy:\'position||9999\'">{{getItemValue(item, col)}}</td><td><a ng-click="open(\'view\', item)" class="btn btn-xs btn-primary"><i class="fa fa-check-square-o"></i></a> <a ng-click="open(\'edit\', item)" class="btn btn-xs btn-warning"><i class="fa fa-edit"></i></a> <a ng-click=delete(item) class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></a></td></tr></tbody></table><div class=row><div class="col-md-5 col-sm-12"><div class=dataTables_info id=sample_2_info role=status aria-live=polite>{{getPagerStatus()}}</div></div><div class="col-md-7 col-sm-12"><div class="dataTables_paginate paging_simple_numbers"><pagination boundary-links=true total-items=pager.totalItems items-per-page=pager.pageSize ng-change=pager.pageChanged() ng-model=pager.page previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo;></pagination></div></div></div></div></div>'),e.put("nggts/directives/gts-crud/gts-crud-details.html",'<div class=modal-header><button ng-click="$dismiss(\'exit\')" type=button class=close data-dismiss=modal aria-hidden=true></button><div class="caption font-blue"><i class="icon-settings font-blue"></i> <span class="caption-subject bold uppercase">{{model.title}} - {{model.action}}</span></div></div><div class=modal-body><div class=row><div class="col col-md-12 form"><div role=form class=form-horizontal><div class=form-body><div ng-repeat="col in model.columns | filter:showColumn | orderBy:\'position||9999\'"><div class="form-group form-md-floating-label" ng-class="{\'form-md-line-input\' : col.type != \'selection\' && col.type != \'multi-selection\', \'form-md-dropdown-input\' : col.type == \'selection\' || col.type == \'multi-selection\'}"><label ng-if="col.type !== \'details\'" class="col-md-2 control-label" for="{{\'form_control_\'+col.name}}">{{col.title}}</label><div ng-if="col.type == \'text\'" class=col-md-10><input type=text ng-model=model.data[col.name] ng-disabled=!isEditable(col.editable) tabindex={{col.position}} class=form-control id="{{\'form_control_\'+col.name}}" placeholder="Ingresar {{col.title}}"><div class=form-control-focus></div></div><div ng-if="col.type == \'date\'" class=col-md-10><gts-date-picker data-autoclose=true data-language=es data-today-highlight=true data-date-format=dd-mm-yyyy data-date-start-date=+0d ng-model=model.data[col.name] ng-disabled=!isEditable(col.editable) tabindex={{col.position}} class=success data-template=default></gts-date-picker><div class=form-control-focus></div></div><div ng-if="col.type == \'password\'" class=col-md-10><input type=password ng-model=model.data[col.name] ng-disabled=!isEditable(col.editable) tabindex={{col.position}} class=form-control id="{{\'form_control_\'+col.name}}" placeholder="Ingresar {{col.title}}"><div class=form-control-focus></div></div><div ng-if="col.type == \'boolean\'" class=col-md-10><input type=text ng-model=model.data[col.name] ng-disabled=!isEditable(col.editable) tabindex={{col.position}} class=form-control id="{{\'form_control_\'+col.name}}" placeholder="Ingresar {{col.title}}"><div class=form-control-focus></div></div><div ng-if="col.type == \'foreign-key\'" class=col-md-10 tabindex={{col.position}}><input type=text ng-model=model.data[col.name] ng-disabled=!isEditable(col.editable) typeahead="item[col.value] as item[col.text] for item in col.options | filter:$viewValue | limitTo:8" typeahead-input-formatter="formatLabel($model, col.options, col.value, col.text)" class=form-control id="{{\'form_control_\'+col.name}}" placeholder="Ingresar {{col.title}}"><div class=form-control-focus></div></div><div ng-if="col.type == \'selection\'" class=col-md-10><ui-select ng-model=model.data[col.name] theme=bootstrap ng-disabled=!isEditable(col.editable)><ui-select-match placeholder="Ingrese texto para buscar...">{{$select.selected[col.text]}}</ui-select-match><ui-select-choices repeat="item[col.value] as item in col.options | filter: $select.search"><div ng-bind-html="item[col.text] | highlight: $select.search"></div></ui-select-choices></ui-select></div><div ng-if="col.type == \'multi-selection\'" class=col-md-10><ui-select multiple ng-model=model.data[col.name] theme=bootstrap close-on-select=false ng-disabled=!isEditable(col.editable)><ui-select-match placeholder="Ingrese texto para buscar...">{{$item[col.text]}}</ui-select-match><ui-select-choices repeat="item[col.value] as item in col.options | filter: $select.search"><div ng-bind-html="item[col.text] | highlight: $select.search"></div></ui-select-choices></ui-select></div><div ng-if="col.type == \'details\'" class=col-md-12><gts-crud grid-template=nggts/directives/gts-crud/gts-crud-details-list.html title={{col.title}} columns=col.columns items=model.data[col.name] icon="fa fa-users" page-size=5></gts-crud></div></div></div><alert ng-show=alert.show type={{alert.type}} close=closeAlert()>{{alert.msg}}</alert></div></div></div></div><div class=row></div></div><div class=modal-footer><button ng-click=cancel() type=button data-dismiss=modal class="btn btn-default">Cerrar</button> <button ng-click=save() ng-if="isEditable(\'$form\')" type=button class="btn btn-primary">Guardar</button></div>'),e.put("nggts/directives/gts-crud/gts-crud-list.html",'<div class="portlet box blue"><div class=portlet-title><div class=caption><i class={{icon}}></i>{{title}} - Listado</div><div class=actions><a href ng-click="open(\'new\')" class="btn btn-default btn-sm"><i class="fa fa-pencil"></i> Agregar</a><div class=btn-group><a class="btn btn-default btn-sm" href=javascript:; data-toggle=dropdown><i class="fa fa-cogs"></i> Operaciones <i class="fa fa-angle-down"></i></a><ul class="dropdown-menu pull-right"><li><a href=javascript:;><i class="fa fa-pencil"></i> Editar</a></li><li><a href=javascript:;><i class="fa fa-trash-o"></i> Borrar</a></li><li><a href=javascript:;><i class="fa fa-ban"></i> Bloquear</a></li></ul></div></div></div><div class=portlet-body><div class=row><div class="col-md-6 col-sm-12"><div class=dataTables_length id=sample_1_length><label><select ng-model=pager.pageSize ng-change=pager.pageChanged() name=sample_1_length aria-controls=sample_1 class="form-control input-xsmall input-inline"><option value=5>5</option><option value=15>15</option><option value=20>20</option><option value=-1>Todos</option></select>Registros</label></div></div><div class="col-md-6 col-sm-12"><div id=sample_1_filter class=dataTables_filter><label>Buscar: <input type=search class="form-control input-inline input-large" placeholder aria-controls=sample_1></label></div></div></div><table class="table table-condensed table-striped table-bordered table-hover" id=sample_2><thead><tr><th ng-repeat="col in columns | filter:{visible : true} | orderBy:\'position||9999\'">{{col.title}}</th><th width=150px></th></tr></thead><tbody><tr ng-repeat="item in items" class="odd gradeX"><td ng-repeat="col in columns | filter:{visible : true} | orderBy:\'position||9999\'">{{getItemValue(item, col)}}</td><td><a ng-click="open(\'view\', item)" class="btn btn-xs btn-primary"><i class="fa fa-check-square-o"></i></a> <a ng-click="open(\'edit\', item)" class="btn btn-xs btn-warning"><i class="fa fa-edit"></i></a> <a ng-click=delete(item) class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></a></td></tr></tbody></table><div class=row><div class="col-md-5 col-sm-12"><div class=dataTables_info id=sample_2_info role=status aria-live=polite>{{getPagerStatus()}}</div></div><div class="col-md-7 col-sm-12"><div class="dataTables_paginate paging_simple_numbers"><pagination boundary-links=true total-items=pager.totalItems items-per-page=pager.pageSize ng-change=pager.pageChanged() ng-model=pager.page previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo;></pagination></div></div></div></div></div>'),e.put("nggts/directives/gts-date-picker/gts-date-picker-default.html",'<input class="form-control form-control-inline input-medium date-picker" size=16 type=text ng-model=[data-model] value>'),e.put("nggts/directives/gts-date-picker/gts-date-picker-form-group.html",'<div class="input-group input-medium date date-picker"><input type=text ng-model=[data-model] class=form-control readonly> <span class=input-group-btn><button class="btn default" type=button><i class="fa fa-calendar"></i></button></span></div>'),e.put("nggts/directives/gts-crud/gts-selection-modal/gts-selection-modal.html","<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><title></title></head><body></body></html>")}]);